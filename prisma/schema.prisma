generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Ú©Ø§Ø±Ø¨Ø± - Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ø³Ø§Ø¯Ù‡ Ø¨Ø§ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±
model User {
  id           String        @id @default(cuid())
  phone        String        @unique // Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„
  password     String        // Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ù‡Ø´ Ø´Ø¯Ù‡
  name         String        // Ù†Ø§Ù… Ù†Ù…Ø§ÛŒØ´ÛŒ
  avatar       String?       // Ø¢ÙˆØ§ØªØ§Ø± (JSON) - null ÛŒØ¹Ù†ÛŒ auto
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  participants Participant[] // Ù¾Ø±ÙˆÚ˜Ù‡â€ŒÙ‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¹Ø¶ÙˆØ´Ù‡
}

model Project {
  id                    String                  @id @default(cuid())
  name                  String
  description           String?
  template              String                  @default("travel")
  splitType             String                  @default("EQUAL")
  trackingOnly          Boolean                 @default(false) // Tracking Mode (true) vs Split Mode (false) - Ø¨Ø±Ø§ÛŒ template personal
  currency              String                  @default("IRR")
  chargeYear            Int?                    // Ø³Ø§Ù„ Ø´Ø§Ø±Ú˜ (Ø´Ù…Ø³ÛŒ) - Ø¨Ø±Ø§ÛŒ template Ø³Ø§Ø®ØªÙ…Ø§Ù†
  shareCode             String                  @unique @default(cuid())
  isArchived            Boolean                 @default(false) // Ø¢Ø±Ø´ÛŒÙˆ Ø´Ø¯Ù‡ / Ø¨Ø³ØªÙ‡ Ø´Ø¯Ù‡
  archivedAt            DateTime?               // ØªØ§Ø±ÛŒØ® Ø¢Ø±Ø´ÛŒÙˆ
  createdAt             DateTime                @default(now())
  updatedAt             DateTime                @updatedAt
  categories            Category[]
  chargeRules           ChargeRule[]
  expenses              Expense[]
  participants          Participant[]
  settlements           Settlement[]
  shoppingItems         ShoppingItem[]          // Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø®Ø±ÛŒØ¯ (Ø¨Ø±Ø§ÛŒ template gathering)
  incomes               Income[]                // Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ (Ø¨Ø±Ø§ÛŒ template family)
  incomeCategories      IncomeCategory[]        // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ (Ø¨Ø±Ø§ÛŒ template family)
  budgets               Budget[]                // Ø¨ÙˆØ¯Ø¬Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ (Ø¨Ø±Ø§ÛŒ template family)
  recurringTransactions RecurringTransaction[] // ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ (Ø¨Ø±Ø§ÛŒ template family)
}

model Participant {
  id                    String                  @id @default(cuid())
  name                  String
  role                  String                  @default("MEMBER")
  weight                Float                   @default(1)
  percentage            Float?
  avatar                String?                 // Ø¢ÙˆØ§ØªØ§Ø± (JSON) - null ÛŒØ¹Ù†ÛŒ auto
  sessionToken          String                  @unique @default(cuid())
  projectId             String
  userId                String?                 // Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø¨Ø±Ø§ÛŒ Ù…Ù‡Ù…Ø§Ù†â€ŒÙ‡Ø§ null)
  createdAt             DateTime                @default(now())
  expensesPaid          Expense[]               @relation("PaidBy")
  expenseShares         ExpenseShare[]
  settlementsFrom       Settlement[]            @relation("SettlementFrom")
  settlementsTo         Settlement[]            @relation("SettlementTo")
  shoppingItemsAdded    ShoppingItem[]          // Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ Ù„ÛŒØ³Øª Ø®Ø±ÛŒØ¯ÛŒ Ú©Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù‡
  incomesReceived       Income[]                @relation("IncomeReceivedBy") // Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø´Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ template family)
  recurringTransactions RecurringTransaction[]  // ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§ÛŒÙ† Ø´Ø®Øµ
  project               Project                 @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user                  User?                   @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([projectId])
}

model Category {
  id                    String                  @id @default(cuid())
  name                  String
  icon                  String?
  color                 String?
  projectId             String
  project               Project                 @relation(fields: [projectId], references: [id], onDelete: Cascade)
  expenses              Expense[]
  budgets               Budget[]                // Ø¨ÙˆØ¯Ø¬Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡ (Ø¨Ø±Ø§ÛŒ template family)
  recurringTransactions RecurringTransaction[]  // ØªØ±Ø§Ú©Ù†Ø´â€ŒÙ‡Ø§ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡

  @@index([projectId])
}

model Expense {
  id          String         @id @default(cuid())
  title       String
  amount      Float
  description String?
  paidById    String
  categoryId  String?
  expenseDate DateTime       @default(now())
  periodKey   String?        // Ø¯ÙˆØ±Ù‡ Ø²Ù…Ø§Ù†ÛŒ: "1403-10" Ø¨Ø±Ø§ÛŒ Ø¯ÛŒâ€ŒÙ…Ø§Ù‡ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø¨Ø±Ø§ÛŒ template Ø³Ø§Ø®ØªÙ…Ø§Ù†)
  receiptUrl  String?
  projectId   String
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  project     Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  category    Category?      @relation(fields: [categoryId], references: [id])
  paidBy      Participant    @relation("PaidBy", fields: [paidById], references: [id])
  shares      ExpenseShare[]

  @@index([projectId, expenseDate(sort: Desc)])
  @@index([projectId, categoryId]) // Filter by category within project
  @@index([projectId, paidById]) // Filter by payer within project
  @@index([periodKey])
  @@index([paidById])
  @@index([categoryId]) // Queries by category
}

model ExpenseShare {
  id            String      @id @default(cuid())
  amount        Float
  weightAtTime  Float       @default(1)
  participantId String
  expenseId     String
  expense       Expense     @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  participant   Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@unique([expenseId, participantId])
  @@index([participantId])
  @@index([expenseId])
}

// ØªØ³ÙˆÛŒÙ‡ Ø­Ø³Ø§Ø¨ - Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨ÛŒÙ† Ø§Ø¹Ø¶Ø§
model Settlement {
  id          String      @id @default(cuid())
  amount      Float       // Ù…Ø¨Ù„Øº Ù¾Ø±Ø¯Ø§Ø®Øª Ø´Ø¯Ù‡
  fromId      String      // Ú©Ø³ÛŒ Ú©Ù‡ Ù¾ÙˆÙ„ Ø¯Ø§Ø¯Ù‡
  toId        String      // Ú©Ø³ÛŒ Ú©Ù‡ Ù¾ÙˆÙ„ Ú¯Ø±ÙØªÙ‡
  projectId   String
  note        String?     // ØªÙˆØ¶ÛŒØ­Ø§Øª
  receiptUrl  String?     // ØªØµÙˆÛŒØ± Ø±Ø³ÛŒØ¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  settledAt   DateTime    @default(now()) // ØªØ§Ø±ÛŒØ® ØªØ³ÙˆÛŒÙ‡
  createdAt   DateTime    @default(now())
  project     Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  from        Participant @relation("SettlementFrom", fields: [fromId], references: [id])
  to          Participant @relation("SettlementTo", fields: [toId], references: [id])

  @@index([projectId, settledAt(sort: Desc)])
  @@index([fromId])
  @@index([toId])
}

// Ù‚Ø§Ø¹Ø¯Ù‡ Ø´Ø§Ø±Ú˜ - ØªØ¹Ø±ÛŒÙ Ù¾Ø±Ø¯Ø§Ø®Øªâ€ŒÙ‡Ø§ÛŒ Ø¯ÙˆØ±Ù‡â€ŒØ§ÛŒ Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø± (Ø¨Ø±Ø§ÛŒ template Ø³Ø§Ø®ØªÙ…Ø§Ù†)
model ChargeRule {
  id          String   @id @default(cuid())
  title       String   // Ø¹Ù†ÙˆØ§Ù†: "Ø´Ø§Ø±Ú˜ Ù…Ø§Ù‡ÛŒØ§Ù†Ù‡"ØŒ "Ø¢Ø¨â€ŒØ¨Ù‡Ø§"
  amount      Float    // Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª Ù…ÙˆØ±Ø¯ Ø§Ù†ØªØ¸Ø§Ø±
  frequency   String   @default("monthly") // monthly | yearly
  splitType   String   @default("WEIGHTED") // Ù†ÙˆØ¹ ØªÙ‚Ø³ÛŒÙ…: EQUAL | WEIGHTED | PERCENTAGE
  isActive    Boolean  @default(true)
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø®Ø±ÛŒØ¯ - Ù„ÛŒØ³Øª Ø®Ø±ÛŒØ¯Ù‡Ø§ Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ±Ù‡Ù…ÛŒ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ template gathering)
model ShoppingItem {
  id        String       @id @default(cuid())
  text      String       // Ù…ØªÙ† Ø¢ÛŒØªÙ… (Ù…Ø«Ù„Ø§Ù‹ "Ù¾ÛŒØªØ²Ø§ Ù¾Ù¾Ø±ÙˆÙ†ÛŒ 2 Ø¹Ø¯Ø¯")
  isChecked Boolean      @default(false) // Ø¢ÛŒØ§ Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ø´Ø¯Ù‡ØŸ
  quantity  String?      // ØªØ¹Ø¯Ø§Ø¯ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  note      String?      // ÛŒØ§Ø¯Ø¯Ø§Ø´Øª (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  addedById String?      // Ú©ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù‡
  projectId String
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
  project   Project      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  addedBy   Participant? @relation(fields: [addedById], references: [id], onDelete: SetNull)

  @@index([projectId])
  @@index([projectId, createdAt])
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ FAMILY FINANCE TEMPLATE MODELS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Ø¯Ø±Ø¢Ù…Ø¯ - Ø«Ø¨Øª Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ÛŒ Ù…Ø§Ù‡Ø§Ù†Ù‡ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ template family)
model Income {
  id          String          @id @default(cuid())
  title       String          // Ø¹Ù†ÙˆØ§Ù† Ø¯Ø±Ø¢Ù…Ø¯
  amount      Float           // Ù…Ø¨Ù„Øº
  description String?         // ØªÙˆØ¶ÛŒØ­Ø§Øª
  source      String?         // Ù…Ù†Ø¨Ø¹ Ø¯Ø±Ø¢Ù…Ø¯: "Ø­Ù‚ÙˆÙ‚", "Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±", "Ø³Ø§ÛŒØ±"
  incomeDate  DateTime        @default(now()) // ØªØ§Ø±ÛŒØ® Ø¯Ø±ÛŒØ§ÙØª
  categoryId  String?         // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø±Ø¢Ù…Ø¯
  receivedById String         // Ú©ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ú©Ø±Ø¯Ù‡
  isRecurring Boolean         @default(false) // Ø¢ÛŒØ§ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³ØªØŸ
  recurringId String?         // Ù„ÛŒÙ†Ú© Ø¨Ù‡ RecurringTransaction
  projectId   String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  project     Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  receivedBy  Participant     @relation("IncomeReceivedBy", fields: [receivedById], references: [id])
  category    IncomeCategory? @relation(fields: [categoryId], references: [id])

  @@index([projectId, incomeDate(sort: Desc)])
  @@index([receivedById])
  @@index([categoryId])
}

// Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¯Ø±Ø¢Ù…Ø¯ - Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ù…Ù†Ø§Ø¨Ø¹ Ø¯Ø±Ø¢Ù…Ø¯ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ template family)
model IncomeCategory {
  id        String   @id @default(cuid())
  name      String   // Ù†Ø§Ù… Ø¯Ø³ØªÙ‡: "Ø­Ù‚ÙˆÙ‚", "Ú©Ø³Ø¨â€ŒÙˆÚ©Ø§Ø±", "Ø³Ø±Ù…Ø§ÛŒÙ‡â€ŒÚ¯Ø°Ø§Ø±ÛŒ"
  icon      String?  // Ø¢ÛŒÚ©ÙˆÙ† emoji
  color     String?  // Ø±Ù†Ú¯ hex
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  incomes   Income[] // Ø¯Ø±Ø¢Ù…Ø¯Ù‡Ø§ÛŒ Ø§ÛŒÙ† Ø¯Ø³ØªÙ‡

  @@index([projectId])
}

// Ø¨ÙˆØ¯Ø¬Ù‡ Ù…Ø§Ù‡Ø§Ù†Ù‡ - ØªØ¹ÛŒÛŒÙ† Ø³Ù‚Ù Ø¨ÙˆØ¯Ø¬Ù‡ Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø³ØªÙ‡ Ø®Ø±Ø¬ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ template family)
model Budget {
  id         String   @id @default(cuid())
  categoryId String   // Ø¨Ø±Ø§ÛŒ Ú©Ø¯Ø§Ù… Ø¯Ø³ØªÙ‡ Ø®Ø±Ø¬
  amount     Float    // Ø³Ù‚Ù Ø¨ÙˆØ¯Ø¬Ù‡ (ØªÙˆÙ…Ø§Ù†)
  periodKey  String   // Ø¯ÙˆØ±Ù‡ Ø²Ù…Ø§Ù†ÛŒ: "1403-10" (Ø³Ø§Ù„-Ù…Ø§Ù‡ Ø´Ù…Ø³ÛŒ)
  projectId  String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  @@unique([projectId, categoryId, periodKey]) // ÛŒÚ© Ø¯Ø³ØªÙ‡ ÙÙ‚Ø· ÛŒÚ© Ø¨ÙˆØ¯Ø¬Ù‡ Ø¯Ø± Ù‡Ø± Ù…Ø§Ù‡
  @@index([projectId, periodKey])
}

// ØªØ±Ø§Ú©Ù†Ø´ ØªÚ©Ø±Ø§Ø±ÛŒ - Ø¯Ø±Ø¢Ù…Ø¯ ÛŒØ§ Ø®Ø±Ø¬â€ŒÙ‡Ø§ÛŒ Ø«Ø§Ø¨Øª Ù…Ø§Ù‡Ø§Ù†Ù‡ (ÙÙ‚Ø· Ø¨Ø±Ø§ÛŒ template family)
model RecurringTransaction {
  id            String      @id @default(cuid())
  type          String      // Ù†ÙˆØ¹: "INCOME" ÛŒØ§ "EXPENSE"
  title         String      // Ø¹Ù†ÙˆØ§Ù†: "Ø­Ù‚ÙˆÙ‚", "Ø§Ø¬Ø§Ø±Ù‡ Ø®Ø§Ù†Ù‡", "Ù‚Ø¨Ø¶ Ø¨Ø±Ù‚"
  amount        Float       // Ù…Ø¨Ù„Øº Ø«Ø§Ø¨Øª
  frequency     String      // ØªÚ©Ø±Ø§Ø±: "DAILY", "WEEKLY", "MONTHLY", "YEARLY"
  startDate     DateTime    // ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹
  endDate       DateTime?   // ØªØ§Ø±ÛŒØ® Ù¾Ø§ÛŒØ§Ù† (Ø§Ø®ØªÛŒØ§Ø±ÛŒ - Ø§Ú¯Ø± null Ø¨Ø§Ø´Ø¯ØŒ Ù†Ø§Ù…Ø­Ø¯ÙˆØ¯)
  categoryId    String?     // Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ (Ø¨Ø±Ø§ÛŒ expense ÛŒØ§ income)
  participantId String      // Ú©ÛŒ Ù¾Ø±Ø¯Ø§Ø®Øª/Ø¯Ø±ÛŒØ§ÙØª Ù…ÛŒâ€ŒÚ©Ù†Ø¯
  isActive      Boolean     @default(true) // ÙØ¹Ø§Ù„ ÛŒØ§ ØºÛŒØ±ÙØ¹Ø§Ù„
  lastProcessed DateTime?   // Ø¢Ø®Ø±ÛŒÙ† Ø¨Ø§Ø±ÛŒ Ú©Ù‡ process Ø´Ø¯Ù‡
  projectId     String
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  project       Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  category      Category?   @relation(fields: [categoryId], references: [id])
  participant   Participant @relation(fields: [participantId], references: [id])

  @@index([projectId])
  @@index([isActive])
  @@index([participantId])
}
